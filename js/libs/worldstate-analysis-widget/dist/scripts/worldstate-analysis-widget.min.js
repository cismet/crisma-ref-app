angular.module("eu.crismaproject.worldstateAnalysis.demoApp",["eu.crismaproject.worldstateAnalysis.demoApp.controllers","eu.crismaproject.worldstateAnalysis.directives","eu.crismaproject.worldstateAnalysis.services","de.cismet.crisma.widgets.worldstateTreeWidget"]),angular.module("eu.crismaproject.worldstateAnalysis.demoApp.controllers",["de.cismet.crisma.ICMM.Worldstates","de.cismet.cids.rest.collidngNames.Nodes"]).controller("eu.crismaproject.worldstateAnalysis.demoApp.controllers.MainController",["$scope","de.cismet.collidingNameService.Nodes","de.cismet.crisma.ICMM.Worldstates",function(a,b,c){"use strict";a.activeItem={},a.treeOptions={checkboxClass:"glyphicon glyphicon-unchecked",folderIconClosed:"icon-world.png",folderIconOpen:"icon-world.png",leafIcon:"icon-world.png",imagePath:"bower_components/crisma-worldstate-tree-widget-angular/dist/images/",multiSelection:!0},a.treeSelection=[],a.$watchCollection("treeSelection",function(b,d){var e,f,g,h=[],i=function(b){h.push(b),h.length===a.treeSelection.length&&(a.worldstates?a.worldstates.splice(0,a.worldstates.length):a.worldstates=[],a.worldstates=h)};if(b!==d)for(a.treeSelection.length<=0&&a.worldstates.splice(0,a.worldstates.length),e=0;e<a.treeSelection.length;e++)g=a.treeSelection[e].objectKey,f=g.substring(g.lastIndexOf("/")+1,g.length),c.get({wsId:f},i)}),a.treeNodes=b.query(function(a){console.log(a)})}]),angular.module("eu.crismaproject.worldstateAnalysis.controllers",[]).controller("eu.crismaproject.worldstateAnalysis.controllers.IndicatorCriteriaTableDirectiveController",["$scope","$filter","de.cismet.crisma.ICMM.Worldstates","ngTableParams",function(a,b,c,d){"use strict";var e=function(a){var b,c;c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c.sort(),c},f=function(){var f,g,h,i,j,k,l,m,n,o,p,q=c.utils.stripIccData(a.worldstates,a.forCriteria);if(a.worldstates&&0!==a.worldstates.length){for(a.rows=[],a.columns=[{title:a.forCriteria?"Criteria":"Indicators",field:"f1",visible:!0}],j=0,i=q[0].data,m=e(i),k=0;k<m.length;++k)for(g=i[m[k]],a.rows[j++]={f1:{name:g.displayName,icon:g.iconResource}},n=e(g),l=0;l<n.length;++l)o=n[l],"displayName"!==o&&"iconResource"!==o&&(a.rows[j++]={f1:{name:g[o].displayName,icon:g[o].iconResource}});for(h=0;h<q.length;++h)for(f="f"+(h+2),a.columns.push({title:q[h].name,field:f,visible:!0}),i=q[h].data,j=0,m=e(i),k=0;k<m.length;++k)for(g=i[m[k]],a.rows[j++][f]=null,n=e(g),l=0;l<n.length;++l)o=n[l],"displayName"!==o&&"iconResource"!==o&&(p=g[o].value,p%1!==0&&(p=b("number")(p,2)),a.rows[j++][f]={name:p+" "+g[o].unit})}a.tableParams?a.tableParams.reload():a.tableParams=new d({page:1,count:a.rows.length},{counts:[],total:a.worldstates.length,getData:function(b,c){return a.worldstates.length<=0?null:void b.resolve(a.rows.slice((c.page()-1)*c.count(),c.page()*c.count()))}})};a.tableVisibleSwitch="0",a.isGroupRow=function(a){return null===a.f2},a.getRowStyle=function(b){var c=a.rows[b],d={"font-weight":"bold"};return a.isGroupRow(c)?d:""},a.getCellStyle=function(a){var b={"text-align":"right"};return a>0?b:""},a.$watchCollection("worldstates",function(){a.worldstates&&f()}),a.$watch("forCriteria",function(b,c){b!==c&&a.worldstates&&f()})}]),angular.module("eu.crismaproject.worldstateAnalysis.directives",["eu.crismaproject.worldstateAnalysis.controllers","ngTable","de.cismet.crisma.ICMM.Worldstates"]).directive("indicatorCriteriaTable",[function(){"use strict";var a;return a={worldstates:"=",forCriteria:"=",detailIcons:"@"},{scope:a,restrict:"E",templateUrl:"templates/indicatorCriteriaTableTemplate.html",controller:"eu.crismaproject.worldstateAnalysis.controllers.IndicatorCriteriaTableDirectiveController"}}]),angular.module("eu.crismaproject.worldstateAnalysis.directives").directive("criteriaRadar",["de.cismet.crisma.ICMM.Worldstates",function(a){"use strict";var b;return b={localModel:"&worldstates"},{scope:b,restrict:"A",link:function(b,c){var d,e,f,g,h,i=[];g={w:c.width(),h:c.width(),maxValue:100,levels:4},e=function(a){var b,c,d,e,f,g,h,j;for(h=[],i=[],b=0;b<a.length;b++){j=[],c=a[b].data,i.push(a[b].name);for(d in c)if(c.hasOwnProperty(d)){e=c[d];for(f in e)e.hasOwnProperty(f)&&"displayName"!==f&&"iconResource"!==f&&(g=e[f],j.push({axis:g.displayName,value:g.value}))}h.push(j)}return h},h=function(){var a=d3.scale.category10(),b=d3.select(c[0]).append("div").append("svg").attr("width",g.w).attr("height",5),d=b.append("g").attr("class","legend").attr("height",5).attr("width",50),e=d.selectAll("rect").data(i).enter().append("rect").attr("y",15).attr("x",0).attr("width",10).attr("height",10).style("fill",function(b,c){return a(c)}),f=d.selectAll("text").data(i).enter().append("text").attr("y",24).attr("x",0).attr("font-size","11px").attr("fill","#737373").text(function(a){return a}),h=[],j=[],k=0,l=0;f.attr("transform",function(a,b){var c=d3.select(this).node().getBBox().width,d=j.reduce(function(a,b){return a+b},0);j.push(c),h.push(c);var e=15*(b-k+1),f=20*(b-k),i=d+e+f;return i+c>g.w&&(l+=20,k=b,j=[c],i=15),"translate("+i+","+l+")"}),l=0,k=0,e.attr("transform",function(a,b){var c=h.reduce(function(a,c,d){return b>d&&d>=k?a+c:a},0),d=15*(b-k),e=20*(b-k),f=c+d+e;return f+h[b]>g.w&&(l+=20,k=b,f=0),"translate("+f+","+l+")"}),b.attr("height",l+50),d.attr("height",l+50),d.attr("transform",function(){var a=d3.select(this).node().getBBox().width,b=(g.w-a)/2;return b=0>b?0:b,"translate("+b+",0)"})},b.$watchCollection("localModel()",function(i,j){if(i!==j&&(c.removeData(),c.empty(),b.localModel()&&b.localModel().length>0)){d=a.utils.stripIccData(b.localModel(),!0),f=e(d);var k=d3.select(c[0]).append("div").attr("style","display:block;margin: 0 auto;").node();RadarChart.draw(k,f,g),h()}})}}}]),angular.module("eu.crismaproject.worldstateAnalysis.services",[]).factory("eu.crismaproject.worldstateAnalysis.services.AnalysisService",[function(){"use strict";var a;return a=function(){var b,c,d,e,f,g,h;return d=1e-7,f=1e6,h=this,g={},e=function(a,b,c){return Math.abs(a-b)<c},c=function(a){var b;for(b=0;b<a.length;++b)if(a[b]<0||a[b]>1)throw"arg value not within range [0, 1]: arg["+b+"]="+a[b]},b=function(a){var b,f;for(c(a),f=0,b=0;b<a.length;++b)f+=a[b];if(!e(f,1,d))throw"sum of vector is not 1: "+f},g.orness=function(a){var c,d,e;for(b(a),d=a.length,e=0,c=0;c<a.length;++c)e+=(d-(c+1))*a[c];return e*=1/(d-1)},g.dispersion=function(a){var c,d;for(b(a),d=0,c=0;c<a.length;++c)0!==a[c]&&(d+=a[c]*Math.log(a[c]));return d*=-1},g.lLSWeights=function(a){var c,d,e;for(d=0,c=1;a>=c;++c)d+=Math.pow(c,Math.E);for(e=[],c=1;a>=c;++c)e[c-1]=Math.pow(c,Math.E)/d;return b(e),e},g.hLSWeights=function(b){return a.lLSWeights(b).reverse()},g.meanWeights=function(b){var c,f,g,h;for(g=1/b,h=[],c=0;b>c;++c)h[c]=g;if(f=a.dispersion(h),!e(f,Math.log(b),d))throw"rounding error: [dispersion="+f+"|log="+Math.log(b)+"]";return h},g.orderedArgs=function(a){return a.slice(0).sort().reverse()},g.aggregateLS=function(d,e,f){var g,h,i,j,k,l,m,n,o,p;if(b(e),c(d),d.length!==e.length)throw"criteria and weights must have the same amount of items";if(f){if(c(f),d.length!==f.length)throw"criteria and importance must have the same amount of items";for(g=[],o=a.orness(e),k=1-o,h=0;h<f.length;++h)l=f[h],p=d[h],m=Math.max(l,k),n=Math.max(l,o),j=m*Math.pow(p,n),g[h]=j}else g=d;for(i=a.orderedArgs(g),j=0,h=0;h<i.length;++h)j+=i[h]*e[h];return j},g}(),{getOwa:function(){return a}}}]),angular.module("eu.crismaproject.worldstateAnalysis.directives").run(["$templateCache",function(a){"use strict";a.put("templates/indicatorCriteriaTableTemplate.html",'<div id="indicatorCriteriaTable">\n    <div ng-hide="worldstates.length > 0" class="alert alert-warning">\n        <strong>Warning: </strong>There are no worldstates selected.\n    </div>\n    <table ng-hide="worldstates.length <= 0" data-ng-table="tableParams" class="table" template-pagination="templates/nopager.html">\n        <thead>\n            <tr>\n                <th ng-repeat="column in columns" class="text-left" ng-style="getCellStyle($index)">\n                    {{column.title}}\n                </th>\n            </tr>\n        </thead>\n        <tbody>\n            <tr data-ng-repeat="row in $data" ng-class="{\'info\':isGroupRow(row)}" ng-style="getRowStyle($index)">\n                <td data-ng-repeat="col in columns" ng-style="getCellStyle($index)">\n                    <img ng-if="isGroupRow(row) || detailIcons" ng-src="{{row[col.field].icon}}">\n                    {{row[col.field].name}}\n                </td>\n            </tr>\n        </tbody>\n    </table>  \n</div>'),a.put("templates/nopager.html","")}]);