angular.module("eu.crismaproject.worldstateAnalysis.demoApp",["eu.crismaproject.worldstateAnalysis.demoApp.controllers","eu.crismaproject.worldstateAnalysis.directives","eu.crismaproject.worldstateAnalysis.services","de.cismet.crisma.widgets.worldstateTreeWidget"]),angular.module("eu.crismaproject.worldstateAnalysis.demoApp.controllers",["de.cismet.crisma.ICMM.Worldstates","de.cismet.cids.rest.collidngNames.Nodes"]).controller("eu.crismaproject.worldstateAnalysis.demoApp.controllers.MainController",["$scope","de.cismet.collidingNameService.Nodes","de.cismet.crisma.ICMM.Worldstates",function(a,b,c){"use strict";a.activeItem={},a.treeOptions={checkboxClass:"glyphicon glyphicon-unchecked",folderIconClosed:"icon-world.png",folderIconOpen:"icon-world.png",leafIcon:"icon-world.png",imagePath:"bower_components/crisma-worldstate-tree-widget-angular/dist/images/",multiSelection:!0},a.treeSelection=[],a.$watchCollection("treeSelection",function(b,d){var e,f,g,h=[],i=function(b){h.push(b),h.length===a.treeSelection.length&&(a.worldstates?a.worldstates.splice(0,a.worldstates.length):a.worldstates=[],a.worldstates=h)};if(b!==d)for(a.treeSelection.length<=0&&a.worldstates.splice(0,a.worldstates.length),e=0;e<a.treeSelection.length;e++)g=a.treeSelection[e].objectKey,f=g.substring(g.lastIndexOf("/")+1,g.length),c.get({wsId:f},i)}),a.treeNodes=b.query()}]),angular.module("eu.crismaproject.worldstateAnalysis.controllers",["nvd3ChartDirectives"]).controller("eu.crismaproject.worldstateAnalysis.controllers.IndicatorCriteriaTableDirectiveController",["$scope","$filter","de.cismet.crisma.ICMM.Worldstates","ngTableParams",function(a,b,c,d){"use strict";var e=function(a){var b,c;c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c.sort(),c},f=function(){var f,g,h,i,j,k,l,m,n,o,p,q=c.utils.stripIccData(a.worldstates,a.forCriteria);if(a.worldstates&&0!==a.worldstates.length){for(a.rows=[],a.columns=[{title:a.forCriteria?"Criteria":"Indicators",field:"f1",visible:!0}],j=0,i=q[0].data,m=e(i),k=0;k<m.length;++k)for(g=i[m[k]],a.rows[j++]={f1:{name:g.displayName,icon:g.iconResource}},n=e(g),l=0;l<n.length;++l)o=n[l],"displayName"!==o&&"iconResource"!==o&&(a.rows[j++]={f1:{name:g[o].displayName,icon:g[o].iconResource}});for(h=0;h<q.length;++h)for(f="f"+(h+2),a.columns.push({title:q[h].name,field:f,visible:!0}),i=q[h].data,j=0,m=e(i),k=0;k<m.length;++k)for(g=i[m[k]],a.rows[j++][f]=null,n=e(g),l=0;l<n.length;++l)o=n[l],"displayName"!==o&&"iconResource"!==o&&(p=g[o].value,p%1!==0&&(p=b("number")(p,2)),a.rows[j++][f]={name:p+" "+g[o].unit})}a.tableParams?a.tableParams.reload():a.tableParams=new d({page:1,count:a.rows.length},{counts:[],total:a.worldstates.length,getData:function(b,c){return a.worldstates.length<=0?null:void b.resolve(a.rows.slice((c.page()-1)*c.count(),c.page()*c.count()))}})};a.tableVisibleSwitch="0",a.isGroupRow=function(a){return null===a.f2},a.getRowStyle=function(b){var c=a.rows[b],d={"font-weight":"bold"};return a.isGroupRow(c)?d:""},a.getCellStyle=function(a){var b={"text-align":"right"};return a>0?b:""},a.$watchCollection("worldstates",function(){a.worldstates&&f()}),a.$watch("forCriteria",function(b,c){b!==c&&a.worldstates&&f()})}]),angular.module("eu.crismaproject.worldstateAnalysis.directives",["eu.crismaproject.worldstateAnalysis.controllers","ngTable","de.cismet.crisma.ICMM.Worldstates"]).directive("indicatorCriteriaTable",[function(){"use strict";var a;return a={worldstates:"=",forCriteria:"=",detailIcons:"@"},{scope:a,restrict:"E",templateUrl:"templates/indicatorCriteriaTableTemplate.html",controller:"eu.crismaproject.worldstateAnalysis.controllers.IndicatorCriteriaTableDirectiveController"}}]),angular.module("eu.crismaproject.worldstateAnalysis.controllers").controller("eu.crismaproject.worldstateAnalysis.controllers.CriteriaRadarChartDirectiveController",["$scope",function(a){"use strict";a.legendItems=[],a.convertToChartDataStructure=function(a){var b,c,d,e,f,g,h,i,j;for(h=[],j=[],b=0;b<a.length;b++){i=[],c=a[b].data,j.push(a[b].name);for(d in c)if(c.hasOwnProperty(d)){e=c[d];for(f in e)e.hasOwnProperty(f)&&"displayName"!==f&&"iconResource"!==f&&(g=e[f],i.push({axis:g.displayName,value:g.value}))}h.push(i)}return[h,j]}}]),angular.module("eu.crismaproject.worldstateAnalysis.directives").directive("criteriaRadar",["de.cismet.crisma.ICMM.Worldstates",function(a){"use strict";var b,c,d;return b={localModel:"&worldstates"},d=function(a,b,c){var d,e,f,g,h,i,j,k,l;d=d3.scale.category10(),e=d3.select(a[0]).append("div").append("svg").attr("width",b.w).attr("height",5),f=e.append("g").attr("class","legend").attr("height",5).attr("width",50),g=f.selectAll("rect").data(c).enter().append("rect").attr("y",15).attr("x",0).attr("width",10).attr("height",10).style("fill",function(a,b){return d(b)}),i=f.selectAll("text").data(c).enter().append("text").attr("y",24).attr("x",0).attr("font-size","11px").attr("fill","#737373").text(function(a){return a}),h=[],j=[],k=0,l=0,i.attr("transform",function(a,c){var d,e,f,g,i;return d=d3.select(this).node().getBBox().width,e=j.reduce(function(a,b){return a+b},0),j.push(d),h.push(d),f=15*(c-k+1),g=20*(c-k),i=e+f+g,i+d>b.w&&(l+=20,k=c,j=[d],i=15),"translate("+i+","+l+")"}),l=0,k=0,g.attr("transform",function(a,c){var d,e,f,g;return d=h.reduce(function(a,b,d){return c>d&&d>=k?a+b:a},0),e=15*(c-k),f=20*(c-k),g=d+e+f,g+h[c]>b.w&&(l+=20,k=c,g=0),"translate("+g+","+l+")"}),e.attr("height",l+50),f.attr("height",l+50),f.attr("transform",function(){var a,c;return a=d3.select(this).node().getBBox().width,c=(b.w-a)/2,c=0>c?0:c,"translate("+c+",0)"})},c=function(b,c){var e,f,g,h;g=c.width?c.width():200,f={w:g,h:g,maxValue:100,levels:4},b.$watchCollection("localModel()",function(){if(c.removeData(),c.empty(),b.localModel()&&b.localModel().length>0){e=a.utils.stripIccData(b.localModel(),!0),h=b.convertToChartDataStructure(e),b.chartData=h[0],b.legendItems=h[1];var g=d3.select(c[0]).append("div").attr("style","display:block;margin: 0 auto;").node();RadarChart.draw(g,b.chartData,f),d(c,f,b.legendItems)}})},{scope:b,restrict:"A",link:c,controller:"eu.crismaproject.worldstateAnalysis.controllers.CriteriaRadarChartDirectiveController"}}]),angular.module("eu.crismaproject.worldstateAnalysis.controllers").controller("eu.crismaproject.worldstateAnalysis.controllers.IndicatorCriteriaAxisChooserDirectiveController",["$scope",function(a){"use strict";var b,c,d;c="true"===a.isXAxis,d={name:c?"Select a x-axis":"Select a y-axis"},b=function(a){var b,c,d,e=[];if(a){var f=a.data;for(b in f)if(f.hasOwnProperty(b)){c=f[b],e.push({name:c.displayName,icon:c.iconResource,isGroup:!0});for(d in c)c.hasOwnProperty(d)&&"displayName"!==d&&"iconResource"!==d&&e.push({name:c[d].displayName,icon:c[d].iconResource,isGroup:!1})}}return e},a.selectedAxis||(a.selectedAxis=d),a.scales=[],a.axisSelected=function(b){a.selectedAxis=a.scales[b]?a.scales[b]:d},a.$watch("iccObject",function(){a.iccObject&&(a.scales=b(a.iccObject))})}]),angular.module("eu.crismaproject.worldstateAnalysis.directives").directive("indicatorCriteriaAxisChooser",[function(){"use strict";var a;return a={iccObject:"=",isXAxis:"@",selectedAxis:"="},{scope:a,restrict:"E",templateUrl:"templates/indicatorCriteriaAxisChooserTemplate.html",controller:"eu.crismaproject.worldstateAnalysis.controllers.IndicatorCriteriaAxisChooserDirectiveController"}}]),angular.module("eu.crismaproject.worldstateAnalysis.controllers").controller("eu.crismaproject.worldstateAnalysis.controllers.RelationAnalysisChartDirectiveController",["$scope","de.cismet.crisma.ICMM.Worldstates",function(a,b){"use strict";var c=this;this.createChartData=function(a,b,d){var e,f,g,h,i=[];if(!a||!b||!d)throw"Invalid configuration. Can no determine chart data for (iccData, xAxis, yaxis):"+a+" , "+b+" , "+d;var j=0;for(e=0;e<a.length;e++){if(f=a[0],!f)throw"Invalid icc object "+f;g=c.getDataValueForAxis(b,f),h=c.getDataValueForAxis(d,f),0===j&&(j=g),i.push({key:e+1+". "+a[e].name,values:[{x:g,y:h}]})}return i},this.getDataValueForAxis=function(a,b){var c,d,e,f,g;if(!a||!a.name)return null;c=a.name,d=b.data;for(g in d)if(d.hasOwnProperty(g)){e=d[g];for(f in e)if(e.hasOwnProperty(f)&&e[f].displayName===c)return e[f].value}return null},a.getXAxisLabel=function(){var b="";return a.xAxis&&a.xAxis.name&&(b=a.xAxis.name),b},a.getYAxisLabel=function(){var b="";return a.yAxis&&a.yAxis.name&&(b=a.yAxis.name),b},a.zScale=d3.scale.linear(),a.yAxisTickFormatFunction=function(){return function(a){return d3.round(a,2)}},a.xAxisTickFormatFunction=function(){return function(a){return d3.round(a,2)}},this.dataChangedWatchCallback=function(){a.worldstates()&&a.worldstates().length>0&&(a.iccData=b.utils.stripIccData(a.worldstates(),a.forCriteria),a.iccObject=a.iccData[0],a.xAxis&&a.yAxis&&-1===a.xAxis.name.indexOf("Select")&&-1===a.yAxis.name.indexOf("Select")&&(a.chartdata=c.createChartData(a.iccData,a.xAxis,a.yAxis)))},this.axisWatchCallback=function(){a.xAxis&&a.yAxis&&-1===a.xAxis.name.indexOf("Select")&&-1===a.yAxis.name.indexOf("Select")&&(a.chartdata=c.createChartData(a.iccData,a.xAxis,a.yAxis))},a.$watch("xAxis",this.axisWatchCallback),a.$watch("yAxis",this.axisWatchCallback),a.$watch("forCriteria",this.dataChangedWatchCallback),a.$watch("worldstates()",this.dataChangedWatchCallback)}]),angular.module("eu.crismaproject.worldstateAnalysis.directives").directive("relationAnalysisChart",["de.cismet.crisma.ICMM.Worldstates",function(){"use strict";var a;return a={worldstates:"&",chartHeight:"@height",forCriteria:"="},{scope:a,restrict:"E",templateUrl:"templates/relationAnalysisChartTemplate.html",controller:"eu.crismaproject.worldstateAnalysis.controllers.RelationAnalysisChartDirectiveController"}}]),angular.module("eu.crismaproject.worldstateAnalysis.services",[]).factory("eu.crismaproject.worldstateAnalysis.services.AnalysisService",[function(){"use strict";var a;return a=function(){var b,c,d,e,f,g,h;return d=1e-7,f=1e6,h=this,g={},e=function(a,b,c){return Math.abs(a-b)<c},c=function(a){var b;for(b=0;b<a.length;++b)if(a[b]<0||a[b]>1)throw"arg value not within range [0, 1]: arg["+b+"]="+a[b]},b=function(a){var b,f;for(c(a),f=0,b=0;b<a.length;++b)f+=a[b];if(!e(f,1,d))throw"sum of vector is not 1: "+f},g.orness=function(a){var c,d,e;for(b(a),d=a.length,e=0,c=0;c<a.length;++c)e+=(d-(c+1))*a[c];return e*=1/(d-1)},g.dispersion=function(a){var c,d;for(b(a),d=0,c=0;c<a.length;++c)0!==a[c]&&(d+=a[c]*Math.log(a[c]));return d*=-1},g.lLSWeights=function(a){var c,d,e;for(d=0,c=1;a>=c;++c)d+=Math.pow(c,Math.E);for(e=[],c=1;a>=c;++c)e[c-1]=Math.pow(c,Math.E)/d;return b(e),e},g.hLSWeights=function(b){return a.lLSWeights(b).reverse()},g.meanWeights=function(b){var c,f,g,h;for(g=1/b,h=[],c=0;b>c;++c)h[c]=g;if(f=a.dispersion(h),!e(f,Math.log(b),d))throw"rounding error: [dispersion="+f+"|log="+Math.log(b)+"]";return h},g.orderedArgs=function(a){return a.slice(0).sort().reverse()},g.aggregateLS=function(d,e,f){var g,h,i,j,k,l,m,n,o,p;if(b(e),c(d),d.length!==e.length)throw"criteria and weights must have the same amount of items";if(f){if(c(f),d.length!==f.length)throw"criteria and importance must have the same amount of items";for(g=[],o=a.orness(e),k=1-o,h=0;h<f.length;++h)l=f[h],p=d[h],m=Math.max(l,k),n=Math.max(l,o),j=m*Math.pow(p,n),g[h]=j}else g=d;for(i=a.orderedArgs(g),j=0,h=0;h<i.length;++h)j+=i[h]*e[h];return j},g}(),{getOwa:function(){return a}}}]),angular.module("eu.crismaproject.worldstateAnalysis.directives").run(["$templateCache",function(a){"use strict";a.put("templates/indicatorCriteriaAxisChooserTemplate.html",'<div class="btn-group">\n    <button type="button" class="btn btn-default btn-sm"> <img ng-src="{{selectedAxis.icon}}" style="margin-right:5px;float:left">{{selectedAxis.name}}</button>\n    <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">\n        <span class="caret"></span>\n        <span class="sr-only">Toggle Dropdown</span>\n    </button>\n    <ul class="dropdown-menu" role="menu">\n        <li ng-repeat="scale in scales" role="presentation" ng-click="axisSelected($index)" ng-class="{\'dropdown-header\':scale.isGroup}">\n            <a ng-if="!scale.isGroup">{{scale.name}}</a>\n            <img ng-if="scale.isGroup" ng-src="{{scale.icon}}" style="margin-right:5px;float:left">\n            <span ng-if="scale.isGroup" style="margin-top: 4px">{{scale.name}}</span>\n        </li>\n    </ul>\n</div>'),a.put("templates/indicatorCriteriaTableTemplate.html",'<div id="indicatorCriteriaTable">\n    <div ng-hide="worldstates.length > 0" class="alert alert-warning">\n        <strong>Warning: </strong>There are no worldstates selected.\n    </div>\n    <table ng-hide="worldstates.length <= 0" data-ng-table="tableParams" class="table" template-pagination="templates/nopager.html">\n        <thead>\n            <tr>\n                <th ng-repeat="column in columns" class="text-left" ng-style="getCellStyle($index)">\n                    {{column.title}}\n                </th>\n            </tr>\n        </thead>\n        <tbody>\n            <tr data-ng-repeat="row in $data" ng-class="{\'info\':isGroupRow(row)}" ng-style="getRowStyle($index)">\n                <td data-ng-repeat="col in columns" ng-style="getCellStyle($index)">\n                    <img ng-if="isGroupRow(row) || detailIcons" ng-src="{{row[col.field].icon}}">\n                    {{row[col.field].name}}\n                </td>\n            </tr>\n        </tbody>\n    </table>  \n</div>'),a.put("templates/nopager.html",""),a.put("templates/relationAnalysisChartTemplate.html",'<div class="col-lg-12">\n    <style>\n        .nvd3 .nv-axis.nv-x path.domain {\n            stroke-opacity: .75;\n        }\n    </style>\n    <div ng-hide="worldstates().length > 0" class="row">\n        <!--two dropdowns for x and y axis-->\n        <div class="alert alert-warning">\n            <strong>Warning: </strong>There are no worldstates selected.\n        </div>\n    </div>\n    <div ng-hide="!(worldstates() && worldstates().length>0)" class="row">\n        <!--two dropdowns for x and y axis-->\n        <div style="float: right;margin-bottom: 10px">\n            <indicator-criteria-axis-chooser is-x-axis="false" icc-object="iccObject" selected-axis="yAxis"></indicator-criteria-axis-chooser>\n            <indicator-criteria-axis-chooser is-x-axis="true" icc-object="iccObject" selected-axis="xAxis"></indicator-criteria-axis-chooser>\n        </div>\n    </div>\n    <div ng-hide="!(worldstates() && worldstates().length>0)" class="row"> \n        <!--chart-->\n        <div class="col-lg-12" nvd3-scatter-chart="" data="chartdata" showlegend="true" interactive="true" tooltips="true" sizerange="[80,80]" zscale="zScale" showdistx="true" showdisty="true" xaxislabel="{{xAxis.name}}" yaxislabel="{{yAxis.name}}" margin="{left:90,top:0,bottom:50,right:50}" yaxistickformat="yAxisTickFormatFunction()" xaxistickformat="xAxisTickFormatFunction()" height="{{chartHeight}}">\n            <svg></svg>\n        </div>\n    </div>\n</div>')}]);