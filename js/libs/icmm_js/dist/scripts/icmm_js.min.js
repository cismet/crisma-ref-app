angular.module("de.cismet.cids.rest.collidngNames.Nodes",["ngResource"]).factory("de.cismet.collidingNameService.Nodes",["$resource","$timeout","CRISMA_ICMM_API","CRISMA_DOMAIN",function(a,b,c,d){"use strict";var e,f,g,h;return f=function(a){var c,d,e,f=function(a){e=this,b(function(){g.children({filter:"parentworldstate.id:"+g.utils.getRequestIdForNodeKey(e.key)},a)},1e3)};if(!a)return null;c=a.childworldstates&&a.childworldstates.length>0?!0:!1;for(var h=a.parentworldstate,i=[a.id];h&&h.parentworldstate;)i.push(h.id),h=h.parentworldstate;return h&&i.push(h.id),d={key:i.reverse().join("."),name:a.name,classKey:42,objectKey:a.$self,type:"objectNode",org:"",dynamicChildren:"",clientSort:!1,derivePermissionsFromClass:!1,icon:"glyphicon glyphicon-globe",iconFactory:null,policy:"default",leaf:!c,isLeaf:!c,getChildren:f}},e=function(a){var b,c,d=JSON.parse(a).$collection,e=[];for(b=0;b<d.length;++b)c=f(d[b]),e.push(c);return e},g=a(c+"/nodes",{nodeId:"@id",domain:d},{get:{method:"GET",params:{deduplicate:!0},url:c+"/"+d+".worldstates/:nodeId?omitNullValues=false&deduplicate=true",transformResponse:function(a){var b;return a?(b=JSON.parse(a),f(b)):null}},query:{method:"GET",isArray:!0,url:c+"/"+d+".worldstates?limit=100&offset=0&level=1&filter=parentworldstate%3Anull&omitNullValues=false&deduplicate=true",transformResponse:function(a){return e(a)}},children:{method:"GET",isArray:!0,params:{level:2},url:c+"/"+d+".worldstates",transformResponse:function(a){return e(a)},dynamicChildren:{method:"POST",url:"",transformResult:function(a){return e(a)}}},scenarios:{method:"GET",isArray:!0,url:c+"/"+d+".worldstates?level=5&filter=childworldstates:\\[\\]&omitNullValues=false&deduplicate=true",transformResponse:function(a){return e(a)}}}),h={getRequestIdForWorldstate:function(a){return a.id},getRequestIdForNodeKey:function(a){return a.indexOf(".")>-1?a.substring(a.lastIndexOf(".")+1,a.length):a}},g.utils=h,g}]),angular.module("de.cismet.crisma.ICMM.Worldstates",["ngResource"]).factory("de.cismet.crisma.ICMM.Worldstates",["$resource","CRISMA_ICMM_API","CRISMA_DOMAIN",function(a,b,c){"use strict";var d=function(a){return a.iccdata=[{$self:"/CRISMA.dataitems/2",id:2,name:"Indicators",description:"Indicator data",lastmodified:(new Date).toISOString(),temporalcoveragefrom:"2010-11-20T10:05:00.000Z",temporalcoverageto:"2010-11-20T11:55:00.000Z",spatialcoverage:"SRID=4326;POINT (47.493611111111 11.100833333333)",datadescriptor:{$self:"/CRISMA.datadescriptors/1",id:1,name:"icc_slot",description:"Dataslot for icc data",categories:[{$self:"/CRISMA.categories/3",id:3,key:"ICC_DATA",classification:{$self:"/CRISMA.classifications/2",id:2,key:"ICC_DATA"}}],defaultaccessinfocontenttype:"application/json",defaultaccessinfo:null},renderingdescriptor:[{gridWidth:"col-sm-12",priority:1,displayHeader:!0,sortable:!1,fullSize:!0,collapsed:!1,collapsible:!0,bodyDirective:"icc-data-body",headerDirective:"icc-data-header",colourClasses:["panel-purple","panel-orange","panel-greenLight","panel-blue","panel-redLight"],mergeId:"iccIndicatorCriteriaWidget",title:"Indicator & Criteria"},{gridWidth:"col-sm-12",priority:0,displayHeader:!0,sortable:!1,fullSize:!0,collapsed:!1,collapsible:!0,bodyDirective:"mini-indicator-body",colourClasses:["txt-color-blue","txt-color-purple","txt-color-greenDark","txt-color-orange","txt-color-redLight"],widgetArea:!1}],actualaccessinfocontenttype:"application/json",actualaccessinfo:'{"casualties":{"displayName":"Casualties","iconResource":"flower_16.png","noOfDead":{"displayName":"Number of dead","iconResource":"flower_dead_16.png","value":"257","unit":"People"},"noOfInjured":{"displayName":"Number of injured","iconResource":"flower_injured_16.png","value":"409","unit":"People"},"noOfHomeless":{"displayName":"Number of homeless","iconResource":"flower_homeless_16.png","value":"129","unit":"People"}},"cost":{"directDamageCost":{"displayName":"Direct damage cost","iconResource":"dollar_direct_16.png","value":"4582048.34","unit":"Dollar"},"displayName":"Economic cost","iconResource":"dollar_16.png","indirectDamageCost":{"displayName":"Indirect damage cost","iconResource":"dollar_indirect_16.png","value":"830923892.47","unit":"Dollar"},"restorationCost":{"displayName":"Direct restoration cost","iconResource":"dollar_restoration_16.png","value":"892930184.91","unit":"Dollar"}},"damagedBuildings":{"displayName":"Damaged buildings","iconResource":"home_16.png","lostBuildings":{"displayName":"Lost buildings","iconResource":"home_lost_16.png","value":"49","unit":"Buildings"},"unsafeBuildings":{"displayName":"Unsafe buildings","iconResource":"home_unsafe_16.png","value":"152","unit":"Buildings"}},"damagedInfrastructure":{"damagedRoadSegments":{"displayName":"Number of damaged road segments","iconResource":"road_damaged_16.png","value":"34","unit":"Roadsegments"},"displayName":"Damaged Infrastructure","iconResource":"road_16.png"},"evacuationCost":{"displayName":"Evacuation cost","iconResource":"money_evac_16.png","totalEvacuationCost":{"displayName":"Total evacuationcost","iconResource":"money_total_evac_16.png","value":"3494023211.23","unit":"Dollar"}}}',categories:[{$self:"/CRISMA.categories/2",id:2,key:"Indicators",classification:{$self:"/CRISMA.classifications/2",id:2,key:"ICC_DATA"}}]},{$self:"/CRISMA.dataitems/3",id:3,name:"Criteria",description:"Criteria data",lastmodified:(new Date).toISOString(),temporalcoveragefrom:"2010-11-20T10:05:00.000Z",temporalcoverageto:"2010-11-20T11:55:00.000Z",spatialcoverage:"SRID=4326;POINT (47.493611111111 11.100833333333)",datadescriptor:{$self:"/CRISMA.datadescriptors/1",id:1,name:"icc_slot",description:"Dataslot for icc data",categories:[{$self:"/CRISMA.categories/3",id:3,key:"ICC_DATA",classification:{$self:"/CRISMA.classifications/2",id:2,key:"ICC_DATA"}}],defaultaccessinfocontenttype:"application/json",defaultaccessinfo:null},renderingdescriptor:[{gridWidth:"col-sm-12",priority:1,displayHeader:!0,sortable:!1,fullSize:!0,collapsed:!1,collapsible:!0,bodyDirective:"icc-data-body",headerDirective:"icc-data-header",colourClasses:["panel-purple","panel-orange","panel-greenLight","panel-blue","panel-redLight"],mergeId:"iccIndicatorCriteriaWidget",title:"Indicator & Criteria"}],actualaccessinfocontenttype:"application/json",actualaccessinfo:'{"casualties":{"displayName":"Casualties","iconResource":"flower_16.png","noOfDead":{"displayName":"Number of dead","iconResource":"flower_dead_16.png","value":"15","unit":"Percent"},"noOfInjured":{"displayName":"Number of injured","iconResource":"flower_injured_16.png","value":"80","unit":"Percent"},"noOfHomeless":{"displayName":"Number of homeless","iconResource":"flower_homeless_16.png","value":"5","unit":"Percent"}},"cost":{"directDamageCost":{"displayName":"Direct damage cost","iconResource":"dollar_direct_16.png","value":"90","unit":"Percent"},"displayName":"Economic cost","iconResource":"dollar_16.png","indirectDamageCost":{"displayName":"Indirect damage cost","iconResource":"dollar_indirect_16.png","value":"50","unit":"Percent"},"restorationCost":{"displayName":"Direct restoration cost","iconResource":"dollar_restoration_16.png","value":"34","unit":"Percent"}},"damagedBuildings":{"displayName":"Damaged buildings","iconResource":"home_16.png","lostBuildings":{"displayName":"Lost buildings","iconResource":"home_lost_16.png","value":"49","unit":"Percent"},"unsafeBuildings":{"displayName":"Unsafe buildings","iconResource":"home_unsafe_16.png","value":"29","unit":"Percent"}},"damagedInfrastructure":{"damagedRoadSegments":{"displayName":"Number of damaged road segments","iconResource":"road_damaged_16.png","value":"34","unit":"Percent"},"displayName":"Damaged Infrastructure","iconResource":"road_16.png"},"evacuationCost":{"displayName":"Evacuation cost","iconResource":"money_evac_16.png","totalEvacuationCost":{"displayName":"Total evacuationcost","iconResource":"money_total_evac_16.png","value":"80","unit":"Percent"}}}',categories:[{$self:"/CRISMA.categories/6",id:6,key:"Criteria",classification:{$self:"/CRISMA.classifications/2",id:2,key:"ICC_DATA"}}]}],a},e=function(a){var b,c,d,e={gridWidth:"col-sm-6",priority:1,displayHeader:!0,sortable:!0,fullSize:!0,collapsed:!1,collapsible:!0,bodyDirective:"wms-leaflet",padding:"no-padding"};if(a.worldstatedata)for(c=0;c<a.worldstatedata.length;c++)b=a.worldstatedata[c],d=Object.create(e),d.title=b.name,d.priority=c+2,b.renderingdescriptor=[],b.renderingdescriptor.push(d)},f=function(a){var b,c,d,e="osmHelperLayer",f="regionHelperLayer",g="backgroundHelperLayer";for(b=0;b<a.worldstatedata.length;b++)switch(c=a.worldstatedata[b].renderingdescriptor[0],d=a.worldstatedata[b],d.name){case"planet_osm_polygon":case"ortho":case"planet_osm_line":case"planet_osm_point":c.mergeId=e,c.priority=20;break;case"regione":case"province":case"comune_aq":case"hospitals":case"schools":case"power_towers":c.mergeId=f,c.priority=30;break;case"contour_dem_25":case"zones":case"clc2006":c.mergeId=g,c.priority=40}},g=function(a){if(!a)return null;var b=JSON.parse(a);return d(b),e(b),f(b),b},h=function(a){var b,c=JSON.parse(a);for(b=0;b<c.length;b++)d(c[b]),e(c[b]);return c},i=a(b+"/"+c+".worldstates/:wsId",{wsId:"@id",deduplicate:!1,level:"5",omitNullValues:"false"},{get:{method:"GET",transformResponse:g},query:{method:"GET",isArray:!0,transformResponse:h}}),j=function(){var a;return a={},a.stripIccData=function(a,b){var c,d,e,f,g,h,i;for(d=[],e=0;e<a.length;++e){for(i=a[e],f=i.iccdata,c=null,g=0;g<f.length&&!c;++g)for(h=0;h<f[g].categories.length&&!c;++h)b&&"Criteria"===f[g].categories[h].key?c=f[g]:b||"Indicators"!==f[g].categories[h].key||(c=f[g]);if(!c)throw"worldstate without proper icc data:"+i;d.push({name:i.name,data:JSON.parse(c.actualaccessinfo)})}return d},a}();return i.utils=j,i}]);