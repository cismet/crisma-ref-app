angular.module("de.cismet.cids.rest.collidngNames.Nodes",["ngResource"]).factory("de.cismet.collidingNameService.Nodes",["$resource","$timeout","CRISMA_ICMM_API","CRISMA_DOMAIN",function(a,b,c,d){"use strict";var e,f,g,h;return f=function(a){var c,d,e,f=function(a){e=this,b(function(){g.children({filter:"parentworldstate.id:"+g.utils.getRequestIdForNodeKey(e.key)},a)},1e3)};if(!a)return null;c=a.childworldstates&&a.childworldstates.length>0?!0:!1;for(var h=a.parentworldstate,i=[a.id];h&&h.parentworldstate;)i.push(h.id),h=h.parentworldstate;return h&&i.push(h.id),d={key:i.reverse().join("."),name:a.name,classKey:42,objectKey:a.$self,type:"objectNode",org:"",dynamicChildren:"",clientSort:!1,derivePermissionsFromClass:!1,icon:"glyphicon glyphicon-globe",iconFactory:null,policy:"default",leaf:!c,isLeaf:!c,getChildren:f}},e=function(a){var b,c,d=JSON.parse(a).$collection,e=[];for(b=0;b<d.length;++b)c=f(d[b]),e.push(c);return e},g=a(c+"/nodes",{nodeId:"@id",domain:d},{get:{method:"GET",params:{deduplicate:!0},url:c+"/"+d+".worldstates/:nodeId?omitNullValues=false&deduplicate=true",transformResponse:function(a){var b;return a?(b=JSON.parse(a),f(b)):null}},query:{method:"GET",isArray:!0,url:c+"/"+d+".worldstates?limit=100&offset=0&level=1&filter=parentworldstate%3Anull&omitNullValues=false&deduplicate=true",transformResponse:function(a){return e(a)}},children:{method:"GET",isArray:!0,params:{level:2},url:c+"/"+d+".worldstates",transformResponse:function(a){return e(a)},dynamicChildren:{method:"POST",url:"",transformResult:function(a){return e(a)}}},scenarios:{method:"GET",isArray:!0,url:c+"/"+d+".worldstates?level=5&filter=childworldstates:\\[\\]&omitNullValues=false&deduplicate=true",transformResponse:function(a){return e(a)}}}),h={getRequestIdForWorldstate:function(a){return a.id},getRequestIdForNodeKey:function(a){return a.indexOf(".")>-1?a.substring(a.lastIndexOf(".")+1,a.length):a}},g.utils=h,g}]),angular.module("de.cismet.crisma.ICMM.Worldstates",["ngResource"]).factory("de.cismet.crisma.ICMM.Worldstates",["$resource","CRISMA_ICMM_API","CRISMA_DOMAIN",function(a,b,c){"use strict";var d=function(a){var b;return b=a.iccdata,b.renderingDescriptor=[{gridWidth:"col-sm-12",priority:1,displayHeader:!0,sortable:!1,fullSize:!0,collapsed:!1,collapsible:!0,bodyDirective:"icc-data-body",headerDirective:"icc-data-header",colourClasses:["panel-purple","panel-orange","panel-greenLight","panel-blue","panel-redLight"],mergeId:"iccIndicatorCriteriaWidget",title:"Indicator & Criteria"},{gridWidth:"col-sm-12",priority:0,displayHeader:!0,sortable:!1,fullSize:!0,collapsed:!1,collapsible:!0,bodyDirective:"mini-indicator-body",colourClasses:["txt-color-blue","txt-color-purple","txt-color-greenDark","txt-color-orange","txt-color-redLight"],widgetArea:!1}],b.categories=[{$self:"/CRISMA.categories/2",id:2,key:"Indicators",classification:{$self:"/CRISMA.classifications/2",id:2,key:"ICC_DATA"}}],a.iccdata=[b],a},e=function(a){var b,c,d,e={gridWidth:"col-sm-6",priority:1,displayHeader:!0,sortable:!0,fullSize:!0,collapsed:!1,collapsible:!0,bodyDirective:"wms-leaflet",padding:"no-padding"};if(a.worldstatedata)for(c=0;c<a.worldstatedata.length;c++)b=a.worldstatedata[c],d=Object.create(e),d.title=b.name,d.priority=c+2,b.renderingdescriptor=[],b.renderingdescriptor.push(d)},f=function(a){var b,c,d,e="osmHelperLayer",f="regionHelperLayer",g="backgroundHelperLayer";for(b=0;b<a.worldstatedata.length;b++)switch(c=a.worldstatedata[b].renderingdescriptor[0],d=a.worldstatedata[b],d.name){case"planet_osm_polygon":case"ortho":case"planet_osm_line":case"planet_osm_point":c.mergeId=e,c.priority=20;break;case"regione":case"province":case"comune_aq":case"hospitals":case"schools":case"power_towers":c.mergeId=f,c.priority=30;break;case"contour_dem_25":case"zones":case"clc2006":c.mergeId=g,c.priority=40}},g=function(a){if(!a)return null;var b=JSON.parse(a);return d(b),e(b),f(b),b},h=function(a){var b,c=JSON.parse(a).$collection;for(b=0;b<c.length;b++)d(c[b]),e(c[b]);return c},i=a(b+"/"+c+".worldstates/:wsId",{wsId:"@id",deduplicate:!1,level:"5",omitNullValues:"false"},{get:{method:"GET",transformResponse:g},query:{method:"GET",isArray:!0,params:{level:"1",omitNullValues:"true"},transformResponse:h}}),j=function(){var a;return a={},a.stripIccData=function(a,b){var c,d,e,f,g,h,i;for(d=[],e=0;e<a.length;++e){for(i=a[e],f=i.iccdata,c=null,g=0;g<f.length&&!c;++g)for(h=0;h<f[g].categories.length&&!c;++h)b&&"Criteria"===f[g].categories[h].key?c=f[g]:b||"Indicators"!==f[g].categories[h].key||(c=f[g]);if(!c)throw"worldstate without proper icc data:"+i;d.push({name:i.name,data:JSON.parse(c.actualaccessinfo)})}return d},a};return i.utils=j(),i}]);