angular.module("de.cismet.crisma.widgets.worldstateTreeWidget",["de.cismet.crisma.widgets.worldstateTreeWidget.directives","de.cismet.crisma.widgets.worldstateTreeWidget.services","de.cismet.crisma.widgets.worldstateTreeWidget.controllers"]),angular.module("de.cismet.crisma.widgets.worldstateTreeWidget.controllers",["de.cismet.crisma.widgets.worldstateTreeWidget.services"]).controller("MainCtrl",["$scope","de.cismet.crisma.widgets.worldstateTreeWidget.services.Nodes",function(a,b){"use strict";a.treeSelection=[],a.activeItem={},a.isWorldstateIcon=!1,a.treeOptions={checkboxClass:"glyphicon glyphicon-unchecked",folderIconClosed:"icon-folder-close.png",folderIconOpen:"icon-folder-open.png",leafIcon:"icon-file.png",imagePath:"./images/",multiSelection:!1},a.switchIcon=function(){a.isWorldstateIcon?(a.treeOptions.folderIconClosed="icon-folder-close.png",a.treeOptions.folderIconOpen="icon-folder-open.png",a.treeOptions.leafIcon="icon-file.png"):(a.treeOptions.folderIconClosed="icon-world.png",a.treeOptions.folderIconOpen="icon-world.png",a.treeOptions.leafIcon="icon-world.png"),a.isWorldstateIcon=!a.isWorldstateIcon},a.switchTreeMode=function(){a.treeOptions.multiSelection=!a.treeOptions.multiSelection},a.nodes=b.query(function(a){console.log(a)})}]),angular.module("de.cismet.crisma.widgets.worldstateTreeWidget.directives",["de.cismet.commons.angular.angularTools"]).directive("catalogueTree",["de.cismet.commons.angular.angularTools.AngularTools",function(a){"use strict";return{templateUrl:"templates/catalogue-tree.html",restrict:"E",link:function(b,c){var d,e,f,g=[],h=!1,i={container:"dynatree-container",node:"dynatree-node",folder:"dynatree-folder",empty:"dynatree-empty",vline:"dynatree-vline",expander:"dynatree-expander",connector:"dynatree-connector",checkbox:"dynatree-checkbox",nodeIcon:"dynatree-icon",title:"dynatree-title",noConnector:"dynatree-no-connector",nodeError:"dynatree-statusnode-error",nodeWait:"dynatree-statusnode-wait",hidden:"dynatree-hidden",combinedExpanderPrefix:"dynatree-exp-",combinedIconPrefix:"dynatree-ico-",hasChildren:"dynatree-has-children",active:"dynatree-active",selected:"dynatree-selected",expanded:"dynatree-expanded",lazy:"dynatree-lazy",focused:"dynatree-focused",partsel:"dynatree-partsel",lastsib:"dynatree-lastsib"},j=function(){var a={};for(var b in i)i.hasOwnProperty(b)&&(a[b]=i[b]);return a},k=function(a,c){var d;return d=a?b.options.leafIcon||"":c?b.options.folderIconOpen||"":b.options.folderIconClosed||""},l=function(a){var b,c;return b=k(a.isLeaf,!1,a),c={title:a.name,isFolder:!a.isLeaf,isLazy:!a.isLeaf,cidsNode:a,icon:b}},m=function(a,b){var d,f,g,h,i,k,l,m=j();a?(g=!0,d=function(a,b){"title"===a.getEventTargetType(b)&&a.toggleSelect()},f=function(a,b){return 32===b.which?(a.toggleSelect(),!1):void 0}):(h=1,m.selected="tree-select",i=!1,k=function(a,b){var c,d;if("expander"===a.getEventTargetType(b)&&a.expand(!a.isExpanded()),"checkbox"===a.getEventTargetType(b))return!0;if(!b.ctrlKey)for(d=a.tree.getSelectedNodes(),c=0;c<d.length;c++)d[c].select(!1);return a.activate(),a.toggleSelect(),!1},d=function(a,b){return"title"===a.getEventTargetType(b)?(a.expand(!a.isExpanded()),!1):void 0},l=function(a){var b,d,e=c.dynatree("getTree"),f=e.getSelectedNodes(!1);for(b=0;b<f.length;b++)d=f[b],d.toggleSelect();return a.activate(),a.select(!0),!0}),b?(c.dynatree("option","checkbox",g||!1),c.dynatree("option","onDblClick",d||null),c.dynatree("option","onClick",k||null),c.dynatree("option","onFocus",l||null),c.dynatree("option","onKeydown",f||null),c.dynatree("option","clickFolderMode",h||3),c.dynatree("option","classNames",m),c.dynatree("option","autoFocus",i||!0)):(e.checkbox=g||!1,e.onDblClick=d||null,e.onKeydown=f||null,e.clickFolderMode=h||3,e.classNames=m,e.autoFocus=i||!0,e.onClick=k||null,e.onFocus=l||null)};if(f=b.$watchCollection("nodes",function(a,d){var e,f,g;if(a!==d)for(b.selectedNodes.splice(0,b.selectedNodes.length),b.activeNode=void 0,f=c.dynatree("getRoot"),f.removeChildren(),e=0;e<a.length;e++)g=a[e],f.addChild(l(g))}),b.$watch("options",function(a,d){var e,f,g,i,j=!1;if(h){for(var l in b.options)if(e=a[l],f=d[l],g=e!==f,i=e&&!f,g||i)switch(l){case"checkboxClass":c.dynatree("option","classNames.checkbox",e);break;case"checkboxEnabled":c.dynatree("option","checkbox",e);break;case"imagePath":c.dynatree("option","imagePath",e);break;case"multiSelection":m(e,!0);break;case"folderIconClosed":j=!0;break;case"folderIconOpen":j=!0;break;case"leafIcon":j=!0}}else h=!0;c.dynatree("getRoot").visit(function(a){j&&(a.data.icon=k(a.data.cidsNode.isLeaf,a.isExpanded(),a.data.cidsNode)),a.render()},!1)},!0),e={selectMode:2,children:g,classNames:i,onActivate:function(c){b.activeNode=c.data.cidsNode,a.safeApply(b)},onSelect:function(c,d){var e,f;return f=d.data.cidsNode,c?b.selectedNodes.push(f):(e=b.selectedNodes.indexOf(f),e>=0&&b.selectedNodes.splice(e,1)),a.safeApply(b),!1},onExpand:function(a){return a.data.icon=k(a.data.cidsNode.isLeaf,a.isExpanded(),a.data.cidsNode),a.render(),!0},onLazyRead:function(a){var b,c,d;b=a.data.cidsNode,a.data.addClass="dynatree-loading",a.render(),c=function(b){var c,e;for(c=0;c<b.length;c++)e=b[c],d=l(e),a.addChild(d);a.data.addClass="",a.setLazyNodeStatus(DTNodeStatus_Ok),a.data.icon=k(a.data.cidsNode.isLeaf,a.isExpanded(),a.data.cidsNode),a.render()},b.getChildren(c)}},b.options)for(var n in b.options)switch(d=b.options[n],n){case"checkboxClass":e.classNames.checkbox=d;break;case"checkboxEnabled":e.checkbox=d||!1;break;case"imagePath":e.imagePath=d;break;case"multiSelection":m(d)}c.dynatree(e)},replace:!0,scope:{nodes:"=",selectedNodes:"=selection",activeNode:"=?",options:"=?"}}}]),angular.module("de.cismet.crisma.widgets.worldstateTreeWidget.services",["ngResource"]).service("de.cismet.crisma.widgets.worldstateTreeWidget.services.Nodes",["$resource","$timeout","CRISMA_ICMM_API","CRISMA_DOMAIN",function(a,b,c,d){"use strict";var e,f;return e=function(a){var c,d,e,g,h,i,j=JSON.parse(a).$collection,k=[],l=function(a){i=this,b(function(){f.children({filter:"parentworldstate.id:"+i.object.id},a)},1e3)};for(c=0;c<j.length;++c)d=j[c],e=d.childworldstates&&d.childworldstates.length>0?!0:!1,g=e?"glyphicon glyphicon-folder-close":"glyphicon glyphicon-map-marker",h={key:d.id,name:d.name,classKey:42,objectKey:d.id,type:"objectNode",org:"",dynamicChildren:"",clientSort:!1,derivePermissionsFromClass:!1,icon:g,isLeaf:!e,object:d,getChildren:l},k.push(h);return k},f=a(c+"/nodes",{nodeId:"@id",domain:d},{get:{method:"GET",params:{deduplicate:!0},url:c+"/"+d+".worldstates"},query:{method:"GET",isArray:!0,url:c+"/"+d+".worldstates?limit=100&offset=0&level=1&filter=parentworldstate%3Anull&omitNullValues=false&deduplicate=true",transformResponse:function(a){return e(a)}},children:{method:"GET",isArray:!0,params:{level:2},url:c+"/"+d+".worldstates",transformResponse:function(a){return e(a)},dynamicChildren:{method:"POST",url:"",transformResult:function(a){return e(a)}}}})}]),angular.module("de.cismet.crisma.widgets.worldstateTreeWidget.directives").run(["$templateCache",function(a){"use strict";a.put("templates/catalogue-tree.html",'<div id="tree">\n\n</div>')}]);